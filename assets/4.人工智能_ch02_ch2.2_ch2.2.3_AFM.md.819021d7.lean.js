import{_ as e,o as t,c as a,j as Q,a as T,U as s}from"./chunks/framework.489e5108.js";const y2=JSON.parse('{"title":"AFM","description":"","frontmatter":{},"headers":[],"relativePath":"4.人工智能/ch02/ch2.2/ch2.2.3/AFM.md","filePath":"4.人工智能/ch02/ch2.2/ch2.2.3/AFM.md","lastUpdated":1696176798000}'),l={name:"4.人工智能/ch02/ch2.2/ch2.2.3/AFM.md"},n=Q("h1",{id:"afm",tabindex:"-1"},[T("AFM "),Q("a",{class:"header-anchor",href:"#afm","aria-label":'Permalink to "AFM"'},"​")],-1),o=Q("h2",{id:"afm提出的动机",tabindex:"-1"},[T("AFM 提出的动机 "),Q("a",{class:"header-anchor",href:"#afm提出的动机","aria-label":'Permalink to "AFM提出的动机"'},"​")],-1),m=Q("p",null,"AFM 的全称是 Attentional Factorization Machines, 从模型的名称上来看是在 FM 的基础上加上了注意力机制，FM 是通过特征隐向量的内积来对交叉特征进行建模，从公式中可以看出所有的交叉特征都具有相同的权重也就是 1，没有考虑到不同的交叉特征的重要性程度：",-1),d={class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},r={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-2.819ex"},xmlns:"http://www.w3.org/2000/svg",width:"44.682ex",height:"6.354ex",role:"img",focusable:"false",viewBox:"0 -1562.5 19749.3 2808.5","aria-hidden":"true"},i=s("",1),p=[i],h=Q("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[Q("msub",null,[Q("mi",null,"y"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"f"),Q("mi",null,"m")])]),Q("mo",null,"="),Q("msub",null,[Q("mi",null,"w"),Q("mn",null,"0")]),Q("mo",null,"+"),Q("munderover",null,[Q("mo",{"data-mjx-texclass":"OP"},"∑"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"i"),Q("mo",null,"="),Q("mn",null,"1")]),Q("mi",null,"n")]),Q("msub",null,[Q("mi",null,"w"),Q("mi",null,"i")]),Q("msub",null,[Q("mi",null,"x"),Q("mi",null,"i")]),Q("mo",null,"+"),Q("munderover",null,[Q("mo",{"data-mjx-texclass":"OP"},"∑"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"i"),Q("mo",null,"="),Q("mn",null,"1")]),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"n")])]),Q("munderover",null,[Q("mo",{"data-mjx-texclass":"OP"},"∑"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"i"),Q("mo",null,"+"),Q("mn",null,"1")]),Q("mi",null,"n")]),Q("mo",null,"<"),Q("msub",null,[Q("mi",null,"v"),Q("mi",null,"i")]),Q("mo",null,","),Q("msub",null,[Q("mi",null,"v"),Q("mi",null,"j")]),Q("mo",null,">"),Q("msub",null,[Q("mi",null,"x"),Q("mi",null,"i")]),Q("msub",null,[Q("mi",null,"x"),Q("mi",null,"j")])])],-1),c=Q("p",null,"如何让不同的交叉特征具有不同的重要性就是 AFM 核心的贡献，在谈论 AFM 交叉特征注意力之前，对于 FM 交叉特征部分的改进还有 FFM，其是考虑到了对于不同的其他特征，某个指定特征的隐向量应该是不同的（相比于 FM 对于所有的特征只有一个隐向量，FFM 对于一个特征有多个不同的隐向量）。",-1),g=Q("h2",{id:"afm模型原理",tabindex:"-1"},[T("AFM 模型原理 "),Q("a",{class:"header-anchor",href:"#afm模型原理","aria-label":'Permalink to "AFM模型原理"'},"​")],-1),u=Q("div",{align:"center"},[Q("img",{src:"https://ryluo.oss-cn-chengdu.aliyuncs.com/图片image-20210131092744905.png",alt:"image-20210131092744905",style:{zoom:"50%"}})],-1),H=Q("h3",{id:"pair-wise-interaction-layer",tabindex:"-1"},[T("Pair-wise Interaction Layer "),Q("a",{class:"header-anchor",href:"#pair-wise-interaction-layer","aria-label":'Permalink to "Pair-wise Interaction Layer"'},"​")],-1),y=Q("p",null,"FM 二阶交叉项：所有非零特征对应的隐向量两两点积再求和，输出的是一个数值",-1),w={class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},L={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-2.819ex"},xmlns:"http://www.w3.org/2000/svg",width:"21.907ex",height:"6.354ex",role:"img",focusable:"false",viewBox:"0 -1562.5 9683 2808.5","aria-hidden":"true"},x=s("",1),M=[x],f=Q("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[Q("munderover",null,[Q("mo",{"data-mjx-texclass":"OP"},"∑"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"i"),Q("mo",null,"="),Q("mn",null,"1")]),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"n")])]),Q("munderover",null,[Q("mo",{"data-mjx-texclass":"OP"},"∑"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"i"),Q("mo",null,"+"),Q("mn",null,"1")]),Q("mi",null,"n")]),Q("mo",null,"<"),Q("msub",null,[Q("mi",null,"v"),Q("mi",null,"i")]),Q("mo",null,","),Q("msub",null,[Q("mi",null,"v"),Q("mi",null,"j")]),Q("mo",null,">"),Q("msub",null,[Q("mi",null,"x"),Q("mi",null,"i")]),Q("msub",null,[Q("mi",null,"x"),Q("mi",null,"j")])])],-1),_=Q("p",null,"AFM 二阶交叉项 (无 attention)：所有非零特征对应的隐向量两两对应元素乘积，然后再向量求和，输出的还是一个向量。",-1),k={class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},Z={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-2.819ex"},xmlns:"http://www.w3.org/2000/svg",width:"19.393ex",height:"6.354ex",role:"img",focusable:"false",viewBox:"0 -1562.5 8571.7 2808.5","aria-hidden":"true"},b=s("",1),D=[b],V=Q("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[Q("munderover",null,[Q("mo",{"data-mjx-texclass":"OP"},"∑"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"i"),Q("mo",null,"="),Q("mn",null,"1")]),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"n")])]),Q("munderover",null,[Q("mo",{"data-mjx-texclass":"OP"},"∑"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"i"),Q("mo",null,"+"),Q("mn",null,"1")]),Q("mi",null,"n")]),Q("mo",{stretchy:"false"},"("),Q("msub",null,[Q("mi",null,"v"),Q("mi",null,"i")]),Q("mo",null,"⊙"),Q("msub",null,[Q("mi",null,"v"),Q("mi",null,"j")]),Q("mo",{stretchy:"false"},")"),Q("msub",null,[Q("mi",null,"x"),Q("mi",null,"i")]),Q("msub",null,[Q("mi",null,"x"),Q("mi",null,"j")])])],-1),E=Q("p",null,[T("上述写法是为了更好的与 FM 进行对比，下面将公式变形方便与原论文中保持一致。首先是特征的隐向量。从上图中可以看出，作者对数值特征也对应了一个隐向量，不同的数值乘以对应的隐向量就可以得到不同的隐向量，相对于 onehot 编码的特征乘以 1 还是其本身 (并没有什么变化)，其实就是为了将公式进行统一。虽然论文中给出了对数值特征定义隐向量，但是在作者的代码中并没有发现有对数值特征进行 embedding 的过程 ("),Q("a",{href:"https://github.com/hexiangnan/attentional_factorization_machine/blob/master/code/AFM.py",target:"_blank",rel:"noreferrer"},"原论文代码链接"),T("）具体原因不详。")],-1),v={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},j={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.357ex"},xmlns:"http://www.w3.org/2000/svg",width:"7.942ex",height:"1.676ex",role:"img",focusable:"false",viewBox:"0 -583 3510.5 740.8","aria-hidden":"true"},A=s("",1),C=[A],F=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("mi",null,"ε"),Q("mo",null,"="),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("msub",null,[Q("mi",null,"v"),Q("mi",null,"i")]),Q("msub",null,[Q("mi",null,"x"),Q("mi",null,"i")])])])],-1),R={class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},O={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.666ex"},xmlns:"http://www.w3.org/2000/svg",width:"28.785ex",height:"2.363ex",role:"img",focusable:"false",viewBox:"0 -750 12722.9 1044.2","aria-hidden":"true"},S=s("",1),P=[S],B=Q("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[Q("msub",null,[Q("mi",null,"f"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"P"),Q("mi",null,"I")])]),Q("mo",{stretchy:"false"},"("),Q("mi",null,"ε"),Q("mo",{stretchy:"false"},")"),Q("mo",null,"="),Q("mo",{fence:"false",stretchy:"false"},"{"),Q("mo",{stretchy:"false"},"("),Q("msub",null,[Q("mi",null,"v"),Q("mi",null,"i")]),Q("mo",null,"⊙"),Q("msub",null,[Q("mi",null,"v"),Q("mi",null,"j")]),Q("mo",{stretchy:"false"},")"),Q("msub",null,[Q("mi",null,"x"),Q("mi",null,"i")]),Q("msub",null,[Q("mi",null,"x"),Q("mi",null,"j")]),Q("msub",null,[Q("mo",{fence:"false",stretchy:"false"},"}"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"i"),Q("mo",null,","),Q("mi",null,"j"),Q("mo",null,"∈"),Q("msub",null,[Q("mi",null,"R"),Q("mi",null,"x")])])])])],-1),I={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},X={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.357ex"},xmlns:"http://www.w3.org/2000/svg",width:"2.82ex",height:"1.902ex",role:"img",focusable:"false",viewBox:"0 -683 1246.5 840.8","aria-hidden":"true"},N=s("",1),z=[N],G=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("msub",null,[Q("mi",null,"R"),Q("mi",null,"x")])])],-1),J={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},q={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.566ex"},xmlns:"http://www.w3.org/2000/svg",width:"6.119ex",height:"2.262ex",role:"img",focusable:"false",viewBox:"0 -750 2704.4 1000","aria-hidden":"true"},$=s("",1),U=[$],W=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("msub",null,[Q("mi",null,"f"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"P"),Q("mi",null,"I")])]),Q("mo",{stretchy:"false"},"("),Q("mi",null,"ε"),Q("mo",{stretchy:"false"},")")])],-1),K={class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},Y={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-3.222ex"},xmlns:"http://www.w3.org/2000/svg",width:"29.135ex",height:"5.371ex",role:"img",focusable:"false",viewBox:"0 -950 12877.5 2374.1","aria-hidden":"true"},Q1=s("",1),T1=[Q1],t1=Q("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mover",null,[Q("mi",null,"y"),Q("mo",{stretchy:"false"},"^")])]),Q("mo",null,"="),Q("msup",null,[Q("mi",null,"p"),Q("mi",null,"T")]),Q("munder",null,[Q("mo",{"data-mjx-texclass":"OP"},"∑"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mo",{stretchy:"false"},"("),Q("mi",null,"i"),Q("mo",null,","),Q("mi",null,"j"),Q("mo",{stretchy:"false"},")"),Q("mo",null,"∈"),Q("msub",null,[Q("mi",null,"R"),Q("mi",null,"x")])])]),Q("mo",{stretchy:"false"},"("),Q("msub",null,[Q("mi",null,"v"),Q("mi",null,"i")]),Q("mo",null,"⊙"),Q("msub",null,[Q("mi",null,"v"),Q("mi",null,"j")]),Q("mo",{stretchy:"false"},")"),Q("msub",null,[Q("mi",null,"x"),Q("mi",null,"i")]),Q("msub",null,[Q("mi",null,"x"),Q("mi",null,"j")]),Q("mo",null,"+"),Q("mi",null,"b")])],-1),a1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},s1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.439ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.138ex",height:"1.439ex",role:"img",focusable:"false",viewBox:"0 -442 503 636","aria-hidden":"true"},e1=Q("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[Q("g",{"data-mml-node":"math"},[Q("g",{"data-mml-node":"mi"},[Q("path",{"data-c":"1D45D",d:"M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z",style:{"stroke-width":"3"}})])])],-1),l1=[e1],n1=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("mi",null,"p")])],-1),o1=Q("p",null,"从开始介绍 Pair-wise Interaction Layer 到现在解决的一个问题是，如何将使用哈达玛积得到的交叉特征转换成一个最终输出需要的数值，到目前为止交叉特征之间的注意力权重还没有出现。在没有详细介绍注意力之前先感性的认识一下如果现在已经有了每个交叉特征的注意力权重，那么交叉特征的输出可以表示为：",-1),m1={class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},d1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-3.222ex"},xmlns:"http://www.w3.org/2000/svg",width:"32.358ex",height:"5.371ex",role:"img",focusable:"false",viewBox:"0 -950 14302.4 2374.1","aria-hidden":"true"},r1=s("",1),i1=[r1],p1=Q("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mover",null,[Q("mi",null,"y"),Q("mo",{stretchy:"false"},"^")])]),Q("mo",null,"="),Q("msup",null,[Q("mi",null,"p"),Q("mi",null,"T")]),Q("munder",null,[Q("mo",{"data-mjx-texclass":"OP"},"∑"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mo",{stretchy:"false"},"("),Q("mi",null,"i"),Q("mo",null,","),Q("mi",null,"j"),Q("mo",{stretchy:"false"},")"),Q("mo",null,"∈"),Q("msub",null,[Q("mi",null,"R"),Q("mi",null,"x")])])]),Q("msub",null,[Q("mi",null,"α"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"i"),Q("mi",null,"j")])]),Q("mo",{stretchy:"false"},"("),Q("msub",null,[Q("mi",null,"v"),Q("mi",null,"i")]),Q("mo",null,"⊙"),Q("msub",null,[Q("mi",null,"v"),Q("mi",null,"j")]),Q("mo",{stretchy:"false"},")"),Q("msub",null,[Q("mi",null,"x"),Q("mi",null,"i")]),Q("msub",null,[Q("mi",null,"x"),Q("mi",null,"j")]),Q("mo",null,"+"),Q("mi",null,"b")])],-1),h1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},c1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.666ex"},xmlns:"http://www.w3.org/2000/svg",width:"2.847ex",height:"1.666ex",role:"img",focusable:"false",viewBox:"0 -442 1258.3 736.2","aria-hidden":"true"},g1=s("",1),u1=[g1],H1=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("msub",null,[Q("mi",null,"α"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"i"),Q("mi",null,"j")])])])],-1),y1=Q("h3",{id:"attention-based-pooling",tabindex:"-1"},[T("Attention-based Pooling "),Q("a",{class:"header-anchor",href:"#attention-based-pooling","aria-label":'Permalink to "Attention-based Pooling"'},"​")],-1),w1=Q("p",null,"对于神经网络注意力相关的基础知识大家可以去看一下邱锡鹏老师的《神经网络与深度学习》第 8 章注意力机制与外部记忆。这里简单的叙述一下使用 MLP 实现注意力机制的计算。假设现在有 n 个交叉特征 (假如维度是 k)，将 nxk 的数据输入到一个 kx1 的全连接网络中，输出的张量维度为 nx1，使用 softmax 函数将 nx1 的向量的每个维度进行归一化，得到一个新的 nx1 的向量，这个向量所有维度加起来的和为 1，每个维度上的值就可以表示原 nxk 数据每一行 (即 1xk 的数据) 的权重。用公式表示为：",-1),L1={class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},x1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.885ex"},xmlns:"http://www.w3.org/2000/svg",width:"34.878ex",height:"2.903ex",role:"img",focusable:"false",viewBox:"0 -891.7 15416.1 1283","aria-hidden":"true"},M1=s("",1),f1=[M1],_1=Q("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[Q("msubsup",null,[Q("mi",null,"α"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"i"),Q("mi",null,"j")]),Q("mo",{"data-mjx-alternate":"1"},"′")]),Q("mo",null,"="),Q("msup",null,[Q("mi",null,"h"),Q("mi",null,"T")]),Q("mi",null,"R"),Q("mi",null,"e"),Q("mi",null,"L"),Q("mi",null,"U"),Q("mo",{stretchy:"false"},"("),Q("mi",null,"W"),Q("mo",{stretchy:"false"},"("),Q("msub",null,[Q("mi",null,"v"),Q("mi",null,"i")]),Q("mo",null,"⊙"),Q("msub",null,[Q("mi",null,"v"),Q("mi",null,"j")]),Q("mo",{stretchy:"false"},")"),Q("msub",null,[Q("mi",null,"x"),Q("mi",null,"i")]),Q("msub",null,[Q("mi",null,"x"),Q("mi",null,"j")]),Q("mo",null,"+"),Q("mi",null,"b"),Q("mo",{stretchy:"false"},")")])],-1),k1=Q("p",null,"使用 softmax 归一化可得：",-1),Z1={class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},b1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-2.652ex"},xmlns:"http://www.w3.org/2000/svg",width:"23.868ex",height:"6.311ex",role:"img",focusable:"false",viewBox:"0 -1617.2 10549.8 2789.4","aria-hidden":"true"},D1=s("",1),V1=[D1],E1=Q("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[Q("msub",null,[Q("mi",null,"α"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"i"),Q("mi",null,"j")])]),Q("mo",null,"="),Q("mfrac",null,[Q("mrow",null,[Q("mi",null,"e"),Q("mi",null,"x"),Q("mi",null,"p"),Q("mo",{stretchy:"false"},"("),Q("msubsup",null,[Q("mi",null,"α"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"i"),Q("mi",null,"j")]),Q("mo",{"data-mjx-alternate":"1"},"′")]),Q("mo",{stretchy:"false"},")")]),Q("mrow",null,[Q("munder",null,[Q("mo",{"data-mjx-texclass":"OP"},"∑"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mo",{stretchy:"false"},"("),Q("mi",null,"i"),Q("mo",null,","),Q("mi",null,"j"),Q("mo",{stretchy:"false"},")"),Q("mo",null,"∈"),Q("msub",null,[Q("mi",null,"R"),Q("mi",null,"x")])])]),Q("mi",null,"e"),Q("mi",null,"x"),Q("mi",null,"p"),Q("mo",{stretchy:"false"},"("),Q("msubsup",null,[Q("mi",null,"α"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"i"),Q("mi",null,"j")]),Q("mo",{"data-mjx-alternate":"1"},"′")]),Q("mo",{stretchy:"false"},")")])])])],-1),v1=Q("p",null,"这样就得到了 AFM 二阶交叉部分的注意力权重，如果将 AFM 的一阶项写在一起，AFM 模型用公式表示为：",-1),j1={class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},A1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-3.222ex"},xmlns:"http://www.w3.org/2000/svg",width:"54.908ex",height:"6.757ex",role:"img",focusable:"false",viewBox:"0 -1562.5 24269.2 2986.6","aria-hidden":"true"},C1=s("",1),F1=[C1],R1=Q("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[Q("msub",null,[Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mover",null,[Q("mi",null,"y"),Q("mo",{stretchy:"false"},"^")])]),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"a"),Q("mi",null,"f"),Q("mi",null,"m")])]),Q("mo",{stretchy:"false"},"("),Q("mi",null,"x"),Q("mo",{stretchy:"false"},")"),Q("mo",null,"="),Q("msub",null,[Q("mi",null,"w"),Q("mn",null,"0")]),Q("mo",null,"+"),Q("munderover",null,[Q("mo",{"data-mjx-texclass":"OP"},"∑"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"i"),Q("mo",null,"="),Q("mn",null,"1")]),Q("mi",null,"n")]),Q("msub",null,[Q("mi",null,"w"),Q("mi",null,"i")]),Q("msub",null,[Q("mi",null,"x"),Q("mi",null,"i")]),Q("mo",null,"+"),Q("msup",null,[Q("mi",null,"p"),Q("mi",null,"T")]),Q("munder",null,[Q("mo",{"data-mjx-texclass":"OP"},"∑"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mo",{stretchy:"false"},"("),Q("mi",null,"i"),Q("mo",null,","),Q("mi",null,"j"),Q("mo",{stretchy:"false"},")"),Q("mo",null,"∈"),Q("msub",null,[Q("mi",null,"R"),Q("mi",null,"x")])])]),Q("msub",null,[Q("mi",null,"α"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"i"),Q("mi",null,"j")])]),Q("mo",{stretchy:"false"},"("),Q("msub",null,[Q("mi",null,"v"),Q("mi",null,"i")]),Q("mo",null,"⊙"),Q("msub",null,[Q("mi",null,"v"),Q("mi",null,"j")]),Q("mo",{stretchy:"false"},")"),Q("msub",null,[Q("mi",null,"x"),Q("mi",null,"i")]),Q("msub",null,[Q("mi",null,"x"),Q("mi",null,"j")]),Q("mo",null,"+"),Q("mi",null,"b")])],-1),O1=Q("h3",{id:"afm模型训练",tabindex:"-1"},[T("AFM 模型训练 "),Q("a",{class:"header-anchor",href:"#afm模型训练","aria-label":'Permalink to "AFM模型训练"'},"​")],-1),S1=Q("p",null,"AFM 从最终的模型公式可以看出与 FM 的模型公式是非常相似的，所以也可以和 FM 一样应用于不同的任务，例如分类、回归及排序（不同的任务的损失函数是不一样的），AFM 也有对防止过拟合进行处理：",-1),P1=Q("li",null,"在 Pair-wise Interaction Layer 层的输出结果上使用 dropout 防止过拟合，因为并不是所有的特征组合对预测结果都有用，所以随机的去除一些交叉特征，让剩下的特征去自适应的学习可以更好的防止过拟合。",-1),B1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},I1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.05ex"},xmlns:"http://www.w3.org/2000/svg",width:"2.371ex",height:"1.595ex",role:"img",focusable:"false",viewBox:"0 -683 1048 705","aria-hidden":"true"},X1=Q("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[Q("g",{"data-mml-node":"math"},[Q("g",{"data-mml-node":"mi"},[Q("path",{"data-c":"1D44A",d:"M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z",style:{"stroke-width":"3"}})])])],-1),N1=[X1],z1=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("mi",null,"W")])],-1),G1=Q("p",null,"加上正则参数之后的回归任务的损失函数表示为：",-1),J1={class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},q1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-2.769ex"},xmlns:"http://www.w3.org/2000/svg",width:"34.942ex",height:"4.919ex",role:"img",focusable:"false",viewBox:"0 -950 15444.4 2174","aria-hidden":"true"},$1=s("",1),U1=[$1],W1=Q("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[Q("mi",null,"L"),Q("mo",null,"="),Q("munder",null,[Q("mo",{"data-mjx-texclass":"OP"},"∑"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"x"),Q("mo",null,"∈"),Q("mi",null,"T")])]),Q("mo",{stretchy:"false"},"("),Q("msub",null,[Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mover",null,[Q("mi",null,"y"),Q("mo",{stretchy:"false"},"^")])]),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"a"),Q("mi",null,"f"),Q("mi",null,"m")])]),Q("mo",{stretchy:"false"},"("),Q("mi",null,"x"),Q("mo",{stretchy:"false"},")"),Q("mo",null,"−"),Q("mi",null,"y"),Q("mo",{stretchy:"false"},"("),Q("mi",null,"x"),Q("mo",{stretchy:"false"},")"),Q("msup",null,[Q("mo",{stretchy:"false"},")"),Q("mn",null,"2")]),Q("mo",null,"+"),Q("mi",null,"λ"),Q("mo",{"data-mjx-texclass":"ORD",stretchy:"false"},"|"),Q("mo",{"data-mjx-texclass":"ORD",stretchy:"false"},"|"),Q("mi",null,"W"),Q("mo",{"data-mjx-texclass":"ORD",stretchy:"false"},"|"),Q("msup",null,[Q("mo",{"data-mjx-texclass":"ORD",stretchy:"false"},"|"),Q("mn",null,"2")])])],-1),K1=Q("h2",{id:"afm代码实现",tabindex:"-1"},[T("AFM 代码实现 "),Q("a",{class:"header-anchor",href:"#afm代码实现","aria-label":'Permalink to "AFM代码实现"'},"​")],-1),Y1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},Q2={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.186ex"},xmlns:"http://www.w3.org/2000/svg",width:"25.125ex",height:"1.756ex",role:"img",focusable:"false",viewBox:"0 -694 11105.2 776","aria-hidden":"true"},T2=s("",1),t2=[T2],a2=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("mi",null,"w"),Q("mn",null,"1"),Q("mi",null,"x"),Q("mn",null,"1"),Q("mo",null,"+"),Q("mi",null,"w"),Q("mn",null,"2"),Q("mi",null,"x"),Q("mn",null,"2."),Q("mo",null,"."),Q("mo",null,"."),Q("mi",null,"w"),Q("mi",null,"n"),Q("mi",null,"x"),Q("mi",null,"n"),Q("mo",null,"+"),Q("mi",null,"b")])],-1),s2={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},e2={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.439ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.138ex",height:"1.439ex",role:"img",focusable:"false",viewBox:"0 -442 503 636","aria-hidden":"true"},l2=Q("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[Q("g",{"data-mml-node":"math"},[Q("g",{"data-mml-node":"mi"},[Q("path",{"data-c":"1D45D",d:"M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z",style:{"stroke-width":"3"}})])])],-1),n2=[l2],o2=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("mi",null,"p")])],-1),m2=Q("li",null,"最终将 linear 部分与 dnn 部分相加之后，通过 sigmoid 激活得到最终的输出",-1),d2=s("",8);function r2(i2,p2,h2,c2,g2,u2){return t(),a("div",null,[n,o,m,Q("mjx-container",d,[(t(),a("svg",r,p)),h]),c,g,u,T(" 上图表示的就是AFM交叉特征部分的模型结构(非交叉部分与FM是一样的，图中并没有给出)。AFM最核心的两个点分别是Pair-wise Interaction Layer和Attention-based Pooling。前者将输入的非零特征的隐向量两两计算element-wise product(哈达玛积，两个向量对应元素相乘，得到的还是一个向量)，假如输入的特征中的非零向量的数量为m，那么经过Pair-wise Interaction Layer之后输出的就是$\\frac{m(m-1)}{2}$个向量，再将前面得到的交叉特征向量组输入到Attention-based Pooling，该pooling层会先计算出每个特征组合的自适应权重(通过Attention Net进行计算)，通过加权求和的方式将向量组压缩成一个向量，由于最终需要输出的是一个数值，所以还需要将前一步得到的向量通过另外一个向量将其映射成一个值，得到最终的基于注意力加权的二阶交叉特征的输出。(对于这部分如果不是很清楚，可以先看下面对两个核心层的介绍) "),H,y,Q("mjx-container",w,[(t(),a("svg",L,M)),f]),_,Q("mjx-container",k,[(t(),a("svg",Z,D)),V]),E,Q("p",null,[T("按照论文的意思，特征的 embedding 可以表示为："),Q("mjx-container",v,[(t(),a("svg",j,C)),F]),T("，经过 Pair-wise Interaction Layer 输出可得：")]),Q("mjx-container",R,[(t(),a("svg",O,P)),B]),Q("p",null,[Q("mjx-container",I,[(t(),a("svg",X,z)),G]),T(" 表示的是有效特征集合。此时的"),Q("mjx-container",J,[(t(),a("svg",q,U)),W]),T(" 表示的是一个向量集合，所以需要先将这些向量集合聚合成一个向量，然后在转换成一个数值：")]),Q("mjx-container",K,[(t(),a("svg",Y,T1)),t1]),Q("p",null,[T("上式中的求和部分就是将向量集合聚合成一个维度与隐向量维度相同的向量，通过向量"),Q("mjx-container",a1,[(t(),a("svg",s1,l1)),n1]),T(" 再将其转换成一个数值，b 表示的是偏置。")]),o1,Q("mjx-container",m1,[(t(),a("svg",d1,i1)),p1]),Q("p",null,[T("就是在交叉特征得到的新向量前面乘以一个注意力权重"),Q("mjx-container",h1,[(t(),a("svg",c1,u1)),H1]),T(", 那么这个注意力权重如何计算得到呢？")]),y1,w1,Q("mjx-container",L1,[(t(),a("svg",x1,f1)),_1]),k1,Q("mjx-container",Z1,[(t(),a("svg",b1,V1)),E1]),v1,Q("mjx-container",j1,[(t(),a("svg",A1,F1)),R1]),O1,S1,Q("ol",null,[P1,Q("li",null,[T("对 Attention-based Pooling 层中的权重矩阵"),Q("mjx-container",B1,[(t(),a("svg",I1,N1)),z1]),T(" 使用 L2 正则，作者没有在这一层使用 dropout 的原因是发现同时在特征交叉层和注意力层加 dropout 会使得模型训练不稳定，并且性能还会下降。")])]),G1,Q("mjx-container",J1,[(t(),a("svg",q1,U1)),W1]),K1,Q("ol",null,[Q("li",null,[T("linear part: 这部分是有关于线性计算，也就是 FM 的前半部分"),Q("mjx-container",Y1,[(t(),a("svg",Q2,t2)),a2]),T(" 的计算。对于这一块的计算，我们用了一个 get_linear_logits 函数实现，后面再说，总之通过这个函数，我们就可以实现上面这个公式的计算过程，得到 linear 的输出")]),Q("li",null,[T("dnn part: 这部分是后面交叉特征的那部分计算，这一部分需要使用注意力机制来将所有类别特征的 embedding 计算注意力权重，然后通过加权求和的方式将所有交叉之后的特征池化成一个向量，最终通过一个映射矩阵"),Q("mjx-container",s2,[(t(),a("svg",e2,n2)),o2]),T(" 将向量转化成一个 logits 值")]),m2]),d2])}const w2=e(l,[["render",r2]]);export{y2 as __pageData,w2 as default};
