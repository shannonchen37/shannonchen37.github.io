import{_ as s,o as n,c as a,U as l}from"./chunks/framework.489e5108.js";const b=JSON.parse('{"title":"IP协议","description":"","frontmatter":{},"headers":[],"relativePath":"9.计算机网络/9.2.3.1IP协议.md","filePath":"9.计算机网络/9.2.3.1IP协议.md","lastUpdated":1696176798000}'),p={name:"9.计算机网络/9.2.3.1IP协议.md"},o=l(`<h1 id="ip协议" tabindex="-1">IP 协议 <a class="header-anchor" href="#ip协议" aria-label="Permalink to &quot;IP协议&quot;">​</a></h1><blockquote><p>Author: 柏喵樱</p><p>copyright reserved</p></blockquote><h2 id="ip-协议数据包结构" tabindex="-1">IP 协议数据包结构 <a class="header-anchor" href="#ip-协议数据包结构" aria-label="Permalink to &quot;IP 协议数据包结构&quot;">​</a></h2><p>IP 协议是网络层最主要的协议，几乎所有的上层数据包都需要 IP 协议的承载，我们网络层的第一块内容将从 IP 协议讲起。</p><p>下图展示了 IP 协议的报文头部格式，这张图每行代表 32 个 bit，也就是 4 个字节（byte）。如果不计算 Options 这种可选项的话，IP 协议的报头长度为 20 个字节。</p><p>在头部的后面，会携带负载（payload），这个词可能略显晦涩，但实际上就是我们需要发送的数据。</p><pre> 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|Version|  IHL  |Type of Service|          Total Length         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|         Identification        |Flags|      Fragment Offset    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  Time to Live |    Protocol   |         Header Checksum       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       Source Address                          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    Destination Address                        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    Options                    |    Padding    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                Example Internet Datagram Header
</pre><h2 id="版本" tabindex="-1">版本 <a class="header-anchor" href="#版本" aria-label="Permalink to &quot;版本&quot;">​</a></h2><p>第一个字段是 IP 协议版本号，用于标识 IPv4 和 IPv6 两个版本，这两个版本的报文格式是不同的。上图展示的是 IPv4 的报文格式</p><h2 id="ihl-internet-header-length" tabindex="-1">IHL（Internet Header Length） <a class="header-anchor" href="#ihl-internet-header-length" aria-label="Permalink to &quot;IHL（Internet Header Length）&quot;">​</a></h2><p>就是 IP 协议的头部部分的长度，单位是 4byte，由于 IP 头一般长度为 20byte，所以这个值一般为 5。如果存在 Options 字段，这个值会相应增加。</p><h2 id="type-of-service" tabindex="-1">Type of Service <a class="header-anchor" href="#type-of-service" aria-label="Permalink to &quot;Type of Service&quot;">​</a></h2><p>服务类型，标记服务类型最初是为了对不同服务的数据包做不同的转发策略，比如说哪些数据包应该被优先转发，应该更注重转发延时还是更注重吞吐量一类的问题，除非到运营商层面一般接触不太到。</p><h2 id="数据包总长度" tabindex="-1">数据包总长度 <a class="header-anchor" href="#数据包总长度" aria-label="Permalink to &quot;数据包总长度&quot;">​</a></h2><p>Total Length 很好理解就是包括 IP 头在内的 IP 报文的总长度，报文长度上限就是 MTU。</p><h2 id="identification-flags-fragment-offset" tabindex="-1">Identification &amp; Flags &amp; Fragment Offset <a class="header-anchor" href="#identification-flags-fragment-offset" aria-label="Permalink to &quot;Identification &amp; Flags &amp; Fragment Offset&quot;">​</a></h2><p>这三个字段放在一起讲，他们都是用于控制分片的。</p><p>我们的 MTU 他一般是 1500，去除 20 bytes 的头部他还能够携带 1480 bytes 的数据，但是现实中的负载很容易就能够超出这个大小，这时候就需要将内容切片分块发送。</p><p>切片时，会切出许多 1480 bytes 的切片，和剩下的不足 1480 bytes 的部分。对于以上的所有切片，都会给他们加一个自己的 IP 头。这些 IP 头有一个共同点，就是他们具有一个相同的 Identification 用于识别（identify）他们原先是一块的。</p><p>现在还存在两个问题，</p><ol><li>服务器接收到一个分片后，不知道要不要继续接收</li><li>分片很有可能乱序抵达，服务器不知道分片的顺序</li></ol><p>对于第二个问题，引入了 Fragment Offset（分片偏移量），他的单位是 byte，用于标识这一个分片的数据，是从原来超长负载的哪个位置开始的。比如对于一个长度为 5000 bytes 的负载，他的几个分片的 Fragment Offset 依次为 0,1480,2960,4440。在收到数据后，服务器只需要按照这个字段重新组装即可。</p><p>对于第一个问题，引入了 Flags（标志位）, Flags 里有三个 Flag，其中最后一位的意义是 “后面还有更多分片 “，这就相当于告诉服务器，你要继续等待接收其他分片。而当最后的分片抵达时，服务器在知道这是最后的分片的同时，他也能从这个分片的 Fragment Offset 里得知前面应该有多少数据，如果缺失，服务器也能继续等待接收。</p><p>关于 Flags 的其他两位，最高位是目前保留不使用，永远为 0。后面那位的意义是不要分片，这一般是不设置的，他这句话是对传输过程中的路由设备讲的，因为如果途径 MTU 低于当前包长度的链路可能会进行二次分片。如果设置了这个 Flag，转发时再碰到 MTU 低的链路这种包会被直接丢弃同时返回一个 ICMP 包告诉源 IP 地址的设备发生了什么。</p><h2 id="ttl-time-to-live" tabindex="-1">TTL(Time To Live) <a class="header-anchor" href="#ttl-time-to-live" aria-label="Permalink to &quot;TTL(Time To Live)&quot;">​</a></h2><p>TTL 是一个 unsigned int，代表数据包的剩余生存时间，指的是数据包在互联网中还能转发多少时间，单位是秒。</p><p>虽然单位是秒，但是一般情况下转发耗时是远远低于一秒的，根据 IP 协议的规定，无论转发耗时多少，TTL 应当至少 -1，所以在实践中 TTL 往往指的是转发了几次。</p><p>一般发往互联网的数据包初始 TTL 为 64 或 128，你可以试试 ping 命令，他会显示一个 TTL，这是对面服务器回复的包到自己的设备的时候的 TTL。</p><div class="language-powershell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">PS C:\\Users\\bs</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> ping </span><span style="color:#79B8FF;">baidu.com</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">正在 Ping </span><span style="color:#79B8FF;">baidu.com</span><span style="color:#E1E4E8;"> [</span><span style="color:#79B8FF;">39.156</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">66.10</span><span style="color:#E1E4E8;">] 具有 </span><span style="color:#79B8FF;">32</span><span style="color:#E1E4E8;"> 字节的数据:</span></span>
<span class="line"><span style="color:#E1E4E8;">来自 </span><span style="color:#79B8FF;">39.156</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">66.10</span><span style="color:#E1E4E8;"> 的回复: 字节</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">32</span><span style="color:#E1E4E8;"> 时间</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">43ms TTL</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">47</span></span>
<span class="line"><span style="color:#E1E4E8;">来自 </span><span style="color:#79B8FF;">39.156</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">66.10</span><span style="color:#E1E4E8;"> 的回复: 字节</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">32</span><span style="color:#E1E4E8;"> 时间</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">144ms TTL</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">47</span></span>
<span class="line"><span style="color:#E1E4E8;">来自 </span><span style="color:#79B8FF;">39.156</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">66.10</span><span style="color:#E1E4E8;"> 的回复: 字节</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">32</span><span style="color:#E1E4E8;"> 时间</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">43ms TTL</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">47</span></span>
<span class="line"><span style="color:#E1E4E8;">来自 </span><span style="color:#79B8FF;">39.156</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">66.10</span><span style="color:#E1E4E8;"> 的回复: 字节</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">32</span><span style="color:#E1E4E8;"> 时间</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">42ms TTL</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">47</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF;">39.156</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">66.10</span><span style="color:#E1E4E8;"> 的 Ping 统计信息:</span></span>
<span class="line"><span style="color:#E1E4E8;">    数据包: 已发送 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">，已接收 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">，丢失 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">0</span><span style="color:#F97583;">%</span><span style="color:#E1E4E8;"> 丢失)，</span></span>
<span class="line"><span style="color:#E1E4E8;">往返行程的估计时间(以毫秒为单位):</span></span>
<span class="line"><span style="color:#E1E4E8;">    最短 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> 42ms，最长 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> 144ms，平均 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> 68ms</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">PS C:\\Users\\bs</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> ping </span><span style="color:#005CC5;">baidu.com</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">正在 Ping </span><span style="color:#005CC5;">baidu.com</span><span style="color:#24292E;"> [</span><span style="color:#005CC5;">39.156</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">66.10</span><span style="color:#24292E;">] 具有 </span><span style="color:#005CC5;">32</span><span style="color:#24292E;"> 字节的数据:</span></span>
<span class="line"><span style="color:#24292E;">来自 </span><span style="color:#005CC5;">39.156</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">66.10</span><span style="color:#24292E;"> 的回复: 字节</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">32</span><span style="color:#24292E;"> 时间</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">43ms TTL</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">47</span></span>
<span class="line"><span style="color:#24292E;">来自 </span><span style="color:#005CC5;">39.156</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">66.10</span><span style="color:#24292E;"> 的回复: 字节</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">32</span><span style="color:#24292E;"> 时间</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">144ms TTL</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">47</span></span>
<span class="line"><span style="color:#24292E;">来自 </span><span style="color:#005CC5;">39.156</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">66.10</span><span style="color:#24292E;"> 的回复: 字节</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">32</span><span style="color:#24292E;"> 时间</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">43ms TTL</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">47</span></span>
<span class="line"><span style="color:#24292E;">来自 </span><span style="color:#005CC5;">39.156</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">66.10</span><span style="color:#24292E;"> 的回复: 字节</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">32</span><span style="color:#24292E;"> 时间</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">42ms TTL</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">47</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;">39.156</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">66.10</span><span style="color:#24292E;"> 的 Ping 统计信息:</span></span>
<span class="line"><span style="color:#24292E;">    数据包: 已发送 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">4</span><span style="color:#24292E;">，已接收 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">4</span><span style="color:#24292E;">，丢失 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">0</span><span style="color:#D73A49;">%</span><span style="color:#24292E;"> 丢失)，</span></span>
<span class="line"><span style="color:#24292E;">往返行程的估计时间(以毫秒为单位):</span></span>
<span class="line"><span style="color:#24292E;">    最短 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> 42ms，最长 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> 144ms，平均 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> 68ms</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>TTL 减少到 0 的时候，这个数据包会被丢弃，所以如果互联网中出现路由配置错误，以至于产生了一个环，TTL 能够帮助数据包及时停止转发，避免事故扩大最终导致网络设施瘫痪。</p><p>当路由设备由于 TTL 为 0，而丢弃这个数据包的时候，路由设备还会向源 IP 回复一个 <code>TTL超时</code> 的 ICMP 报文</p><div class="language-powershell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">PS C:\\Users\\bs</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> ping </span><span style="color:#79B8FF;">baidu.com</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">i </span><span style="color:#79B8FF;">2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">正在 Ping </span><span style="color:#79B8FF;">baidu.com</span><span style="color:#E1E4E8;"> [</span><span style="color:#79B8FF;">39.156</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">66.10</span><span style="color:#E1E4E8;">] 具有 </span><span style="color:#79B8FF;">32</span><span style="color:#E1E4E8;"> 字节的数据:</span></span>
<span class="line"><span style="color:#E1E4E8;">来自 </span><span style="color:#79B8FF;">192.168</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">1.1</span><span style="color:#E1E4E8;"> 的回复: TTL 传输中过期。</span></span>
<span class="line"><span style="color:#E1E4E8;">来自 </span><span style="color:#79B8FF;">192.168</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">1.1</span><span style="color:#E1E4E8;"> 的回复: TTL 传输中过期。</span></span>
<span class="line"><span style="color:#E1E4E8;">来自 </span><span style="color:#79B8FF;">192.168</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">1.1</span><span style="color:#E1E4E8;"> 的回复: TTL 传输中过期。</span></span>
<span class="line"><span style="color:#E1E4E8;">来自 </span><span style="color:#79B8FF;">192.168</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">1.1</span><span style="color:#E1E4E8;"> 的回复: TTL 传输中过期。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF;">39.156</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">66.10</span><span style="color:#E1E4E8;"> 的 Ping 统计信息:</span></span>
<span class="line"><span style="color:#E1E4E8;">    数据包: 已发送 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">，已接收 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">，丢失 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">0</span><span style="color:#F97583;">%</span><span style="color:#E1E4E8;"> 丢失)，</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">PS C:\\Users\\bs</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> ping </span><span style="color:#005CC5;">baidu.com</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">i </span><span style="color:#005CC5;">2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">正在 Ping </span><span style="color:#005CC5;">baidu.com</span><span style="color:#24292E;"> [</span><span style="color:#005CC5;">39.156</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">66.10</span><span style="color:#24292E;">] 具有 </span><span style="color:#005CC5;">32</span><span style="color:#24292E;"> 字节的数据:</span></span>
<span class="line"><span style="color:#24292E;">来自 </span><span style="color:#005CC5;">192.168</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">1.1</span><span style="color:#24292E;"> 的回复: TTL 传输中过期。</span></span>
<span class="line"><span style="color:#24292E;">来自 </span><span style="color:#005CC5;">192.168</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">1.1</span><span style="color:#24292E;"> 的回复: TTL 传输中过期。</span></span>
<span class="line"><span style="color:#24292E;">来自 </span><span style="color:#005CC5;">192.168</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">1.1</span><span style="color:#24292E;"> 的回复: TTL 传输中过期。</span></span>
<span class="line"><span style="color:#24292E;">来自 </span><span style="color:#005CC5;">192.168</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">1.1</span><span style="color:#24292E;"> 的回复: TTL 传输中过期。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;">39.156</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">66.10</span><span style="color:#24292E;"> 的 Ping 统计信息:</span></span>
<span class="line"><span style="color:#24292E;">    数据包: 已发送 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">4</span><span style="color:#24292E;">，已接收 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">4</span><span style="color:#24292E;">，丢失 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">0</span><span style="color:#D73A49;">%</span><span style="color:#24292E;"> 丢失)，</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>traceroute 就是利用这个性质来实现的，通过从 0 开始遍历 TTL 的方式，可以拿到转发过程中的所有路由器的 ICMP 回复，从这些回复中可以读取到这些路由器的 IP。</p><p>当然 traceroute 不是万能的，真实互联网中广泛存在拦截，不响应 ，改写等等行为，会导致 traceroute 产生丢失或者藏跳等等比较迷惑的结果。</p><div class="language-powershell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">PS C:\\Users\\bs</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">TRACERT.EXE</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">bilibili.com</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">通过最多 </span><span style="color:#79B8FF;">30</span><span style="color:#E1E4E8;"> 个跃点跟踪</span></span>
<span class="line"><span style="color:#E1E4E8;">到 </span><span style="color:#79B8FF;">bilibili.com</span><span style="color:#E1E4E8;"> [</span><span style="color:#79B8FF;">8.134</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">50.24</span><span style="color:#E1E4E8;">] 的路由:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">8</span><span style="color:#E1E4E8;"> ms    </span><span style="color:#79B8FF;">13</span><span style="color:#E1E4E8;"> ms     </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;"> ms  </span><span style="color:#79B8FF;">192.168</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">0.1</span><span style="color:#E1E4E8;"> [</span><span style="color:#79B8FF;">192.168</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">0.1</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> ms     </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> ms     </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;"> ms  </span><span style="color:#79B8FF;">192.168</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">1.1</span><span style="color:#E1E4E8;"> [</span><span style="color:#79B8FF;">192.168</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">1.1</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">8</span><span style="color:#E1E4E8;"> ms     </span><span style="color:#79B8FF;">8</span><span style="color:#E1E4E8;"> ms     </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">100.66</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">0.1</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">     </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">     请求超时。</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">5</span><span style="color:#E1E4E8;">     </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">     请求超时。</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">6</span><span style="color:#E1E4E8;">     </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">     请求超时。</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">7</span><span style="color:#E1E4E8;">     </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">     请求超时。</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">8</span><span style="color:#E1E4E8;">     </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">8</span><span style="color:#E1E4E8;"> ms  </span><span style="color:#79B8FF;">61.139</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">121.77</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">9</span><span style="color:#E1E4E8;">     </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">     请求超时。</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">10</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">78</span><span style="color:#E1E4E8;"> ms     </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">113.96</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">5.134</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">11</span><span style="color:#E1E4E8;">     </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">83</span><span style="color:#E1E4E8;"> ms    </span><span style="color:#79B8FF;">43</span><span style="color:#E1E4E8;"> ms  </span><span style="color:#79B8FF;">121.14</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">50.241</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">45</span><span style="color:#E1E4E8;"> ms    </span><span style="color:#79B8FF;">42</span><span style="color:#E1E4E8;"> ms    </span><span style="color:#79B8FF;">41</span><span style="color:#E1E4E8;"> ms  </span><span style="color:#79B8FF;">121.14</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">24.82</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">13</span><span style="color:#E1E4E8;">     </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">     请求超时。</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">14</span><span style="color:#E1E4E8;">     </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">     请求超时。</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#E1E4E8;">     </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">     请求超时。</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16</span><span style="color:#E1E4E8;">     </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">     请求超时。</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">17</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">42</span><span style="color:#E1E4E8;"> ms    </span><span style="color:#79B8FF;">50</span><span style="color:#E1E4E8;"> ms    </span><span style="color:#79B8FF;">40</span><span style="color:#E1E4E8;"> ms  </span><span style="color:#79B8FF;">8.134</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">50.24</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">跟踪完成。</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">PS C:\\Users\\bs</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">TRACERT.EXE</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">bilibili.com</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">通过最多 </span><span style="color:#005CC5;">30</span><span style="color:#24292E;"> 个跃点跟踪</span></span>
<span class="line"><span style="color:#24292E;">到 </span><span style="color:#005CC5;">bilibili.com</span><span style="color:#24292E;"> [</span><span style="color:#005CC5;">8.134</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">50.24</span><span style="color:#24292E;">] 的路由:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">8</span><span style="color:#24292E;"> ms    </span><span style="color:#005CC5;">13</span><span style="color:#24292E;"> ms     </span><span style="color:#005CC5;">2</span><span style="color:#24292E;"> ms  </span><span style="color:#005CC5;">192.168</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">0.1</span><span style="color:#24292E;"> [</span><span style="color:#005CC5;">192.168</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">0.1</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> ms     </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> ms     </span><span style="color:#005CC5;">2</span><span style="color:#24292E;"> ms  </span><span style="color:#005CC5;">192.168</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">1.1</span><span style="color:#24292E;"> [</span><span style="color:#005CC5;">192.168</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">1.1</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">3</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">8</span><span style="color:#24292E;"> ms     </span><span style="color:#005CC5;">8</span><span style="color:#24292E;"> ms     </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">100.66</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">0.1</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">4</span><span style="color:#24292E;">     </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">     请求超时。</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">5</span><span style="color:#24292E;">     </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">     请求超时。</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">6</span><span style="color:#24292E;">     </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">     请求超时。</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">7</span><span style="color:#24292E;">     </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">     请求超时。</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">8</span><span style="color:#24292E;">     </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">        </span><span style="color:#005CC5;">8</span><span style="color:#24292E;"> ms  </span><span style="color:#005CC5;">61.139</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">121.77</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">9</span><span style="color:#24292E;">     </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">     请求超时。</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#005CC5;">10</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">78</span><span style="color:#24292E;"> ms     </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">113.96</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">5.134</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#005CC5;">11</span><span style="color:#24292E;">     </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">       </span><span style="color:#005CC5;">83</span><span style="color:#24292E;"> ms    </span><span style="color:#005CC5;">43</span><span style="color:#24292E;"> ms  </span><span style="color:#005CC5;">121.14</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">50.241</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#005CC5;">12</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">45</span><span style="color:#24292E;"> ms    </span><span style="color:#005CC5;">42</span><span style="color:#24292E;"> ms    </span><span style="color:#005CC5;">41</span><span style="color:#24292E;"> ms  </span><span style="color:#005CC5;">121.14</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">24.82</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#005CC5;">13</span><span style="color:#24292E;">     </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">     请求超时。</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#005CC5;">14</span><span style="color:#24292E;">     </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">     请求超时。</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#24292E;">     </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">     请求超时。</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#005CC5;">16</span><span style="color:#24292E;">     </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">     请求超时。</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#005CC5;">17</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">42</span><span style="color:#24292E;"> ms    </span><span style="color:#005CC5;">50</span><span style="color:#24292E;"> ms    </span><span style="color:#005CC5;">40</span><span style="color:#24292E;"> ms  </span><span style="color:#005CC5;">8.134</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">50.24</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">跟踪完成。</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>上面就是一个真实案例，有很多路由设备在丢弃数据包时并没有给出 ICMP 回复。</p><h2 id="协议" tabindex="-1">协议 <a class="header-anchor" href="#协议" aria-label="Permalink to &quot;协议&quot;">​</a></h2><p>协议（Protocol）指的是负载中的数据所使用的协议。这就很广泛了，比如</p><ul><li><p>TCP</p></li><li><p>UDP</p></li><li><p>ICMP</p></li><li><p>Telnet</p></li><li><p>OSPF</p></li></ul><p>具体可以参考 <a href="https://en.wikipedia.org/wiki/List_of_IP_protocol_numbers" target="_blank" rel="noreferrer">List of IP protocol numbers - Wikipedia</a></p><h2 id="头部校验和" tabindex="-1">头部校验和 <a class="header-anchor" href="#头部校验和" aria-label="Permalink to &quot;头部校验和&quot;">​</a></h2><p>头部校验和（Header Checksum）用于检验传输的数据是否出错，一旦出错直接丢弃。</p><p>在计算头部的校验和的时候，头部校验和这个字段会被置零，再使用特定算法计算得到校验和，填写到这个位置。</p><p>这个校验和算法比较简单，就是头部以 16 bits 为单位，取补码再求和</p><p>注意，由于 TTL 在每次转发中都会改变，所以实际上，每次转发都会重新计算校验和。</p><h2 id="ip地址" tabindex="-1">IP 地址 <a class="header-anchor" href="#ip地址" aria-label="Permalink to &quot;IP地址&quot;">​</a></h2><p>正如上图的 <code>Source Address</code> 和 <code>Destination Address</code> 字段所展示的一样，一个 IP 地址占用 4 byte 的存储空间。在书面的写法上，我们用 <code>.</code> 将每一个 byte 分割开，例如 <code>1.1.1.1</code> 这样更便于人类处理和分类。</p><p>有一些 IP 地址被用作特殊用途，除了这些 IP 地址外的地址都是公网 IP，一个公网 IP 在整个互联网范围内按照规范来说，只能由一台网络设备占有（也有例外，anycast）。但互联网是复杂的，也有人占用这些地址作为自己的内网地址（例如 tr069），这个由网络运维人员自行分析情景把握。</p><p>网络地址的分类需要更多的前置知识，我们后续再介绍。</p><h2 id="可选项" tabindex="-1">可选项 <a class="header-anchor" href="#可选项" aria-label="Permalink to &quot;可选项&quot;">​</a></h2><p>可选参数（Options）比较繁琐，一般没啥用，有兴趣的可以看看下面参考资料中 RFC 791 对此的描述。</p><h2 id="参考资料" tabindex="-1">参考资料 <a class="header-anchor" href="#参考资料" aria-label="Permalink to &quot;参考资料&quot;">​</a></h2><ul><li><a href="https://datatracker.ietf.org/doc/html/rfc791" target="_blank" rel="noreferrer">RFC 791 - Internet Protocol (ietf.org)</a></li><li><a href="https://en.wikipedia.org/wiki/Reserved_IP_addresses" target="_blank" rel="noreferrer">Reserved IP addresses - Wikipedia</a></li><li><a href="https://en.wikipedia.org/wiki/List_of_IP_protocol_numbers" target="_blank" rel="noreferrer">List of IP protocol numbers - Wikipedia</a></li></ul>`,53),e=[o];function r(c,t,E,y,i,F){return n(),a("div",null,e)}const m=s(p,[["render",r]]);export{b as __pageData,m as default};
